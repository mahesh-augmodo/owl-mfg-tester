from dataclasses import dataclass
from typing import Optional


@dataclass
class CommandResult:
    """
    Represents the detailed result of a command execution.

    This dataclass provides an unambiguous way to convey the outcome of
    executing a subprocess command, separating success indicators from
    various forms of output and error information.

    Attributes:
        is_success: True if the command executed successfully (typically exit code 0)
                    and met any additional success criteria (e.g., expected output).
                    False otherwise (e.g., timeout, non-zero exit code, unexpected output).
        stdout: The standard output of the command, if captured and decoded.
                Defaults to None if no stdout or if not captured.
        stderr: The standard error of the command, if captured and decoded.
                Defaults to None if no stderr or if not captured.
        error_message: A descriptive error message generated by the execution wrapper
                       if `is_success` is False. This summarizes the reason for failure
                       (e.g., timeout, command not found, output validation failed).
                       Defaults to None on success.
        exit_code: The numeric exit code of the command. Defaults to None if the
                   command could not be executed or timed out before returning a code.
    """
    is_success: bool
    stdout: Optional[str] = None
    stderr: Optional[str] = None
    error_message: Optional[str] = None
    exit_code: Optional[int] = None

    def __post_init__(self):
        # Ensure consistency: if successful, clear any error_message that might have been set
        if self.is_success:
            self.error_message = None
        # If not successful and no specific error message provided, generate a generic one
        elif not self.is_success and self.error_message is None:
            self.error_message = f"Command failed with exit code {self.exit_code}" if self.exit_code is not None else "Command failed."

    @property
    def full_output(self) -> str:
        """
        Combines standard output and standard error into a single string,
        separated by a newline if both are present.
        """
        output_parts = []
        if self.stdout:
            output_parts.append(self.stdout)
        if self.stderr:
            output_parts.append(self.stderr)
        return "\n".join(output_parts)
